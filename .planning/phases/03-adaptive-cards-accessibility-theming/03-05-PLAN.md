---
phase: 03-adaptive-cards-accessibility-theming
plan: 05
type: execute
wave: 3
depends_on: [03-03, 03-04]
files_modified:
  - client/src/components/TranscriptView.tsx
  - client/src/components/ChatInput.tsx
  - client/src/components/SkeletonBubble.tsx
  - client/src/components/chat.css
autonomous: true
requirements: [UI-16, UI-17]

must_haves:
  truths:
    - "Screen reader announces new messages via ARIA live region on the transcript"
    - "All interactive elements (textarea, send button, theme toggle, card buttons) are reachable by Tab key"
    - "All interactive elements have visible focus rings when navigated by keyboard"
    - "SkeletonBubble is hidden from screen readers (decorative)"
    - "Color contrast meets WCAG 2.2 AA (4.5:1 for normal text) in both light and dark themes"
  artifacts:
    - path: "client/src/components/TranscriptView.tsx"
      provides: "aria-live='polite' role='log' ARIA live region on the transcript container"
      contains: "aria-live"
    - path: "client/src/components/SkeletonBubble.tsx"
      provides: "aria-hidden='true' on skeleton (decorative, not announced)"
      contains: "aria-hidden"
    - path: "client/src/components/chat.css"
      provides: ":focus-visible styles with visible rings for all interactive elements"
      contains: ":focus-visible"
  key_links:
    - from: "client/src/components/TranscriptView.tsx"
      to: "ARIA live region"
      via: "aria-live='polite' attribute on .transcriptView div"
      pattern: "aria-live"
---

<objective>
Harden the full UI to WCAG 2.2 Level AA: add ARIA live region to the transcript, make SkeletonBubble screen-reader-invisible, add visible focus rings to all interactive elements, and verify keyboard operability across the complete component tree.

Purpose: UI-16 (ARIA live region), UI-17 (keyboard nav + focus states).
Output: Updated TranscriptView, ChatInput, SkeletonBubble, and chat.css with WCAG AA compliance.
</objective>

<execution_context>
@/Users/zycroft/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zycroft/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-adaptive-cards-accessibility-theming/03-CONTEXT.md
@.planning/phases/03-adaptive-cards-accessibility-theming/03-RESEARCH.md
@.planning/phases/03-adaptive-cards-accessibility-theming/03-02-SUMMARY.md
@.planning/phases/03-adaptive-cards-accessibility-theming/03-03-SUMMARY.md
@.planning/phases/03-adaptive-cards-accessibility-theming/03-04-SUMMARY.md
@client/src/components/TranscriptView.tsx
@client/src/components/ChatInput.tsx
@client/src/components/SkeletonBubble.tsx
@client/src/components/chat.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: ARIA live region + screen reader improvements</name>
  <files>
    client/src/components/TranscriptView.tsx
    client/src/components/SkeletonBubble.tsx
  </files>
  <action>
    **Modify `client/src/components/TranscriptView.tsx`:**

    Add ARIA attributes to the transcript container div (UI-16):
    ```tsx
    <div
      className="transcriptView"
      ref={containerRef}
      role="log"
      aria-live="polite"
      aria-label="Conversation transcript"
      aria-relevant="additions"
    >
    ```

    `role="log"` is semantically correct for a chat transcript (implies live region). `aria-live="polite"` is explicit and redundant with role but portable. `aria-relevant="additions"` tells screen readers to only announce added content (not removals).

    **Modify `client/src/components/SkeletonBubble.tsx`:**

    Add `aria-hidden="true"` to the skeleton container so it is not announced to screen readers (it is purely decorative — the actual content will arrive and be announced via the live region):
    ```tsx
    <div className="skeletonBubble" aria-hidden="true" role="presentation">
      <div className="skeletonAvatar" />
      <div className="skeleton" />
    </div>
    ```

    Run `cd client && npx tsc --noEmit` — must exit 0.
  </action>
  <verify>
    grep "aria-live" client/src/components/TranscriptView.tsx
    grep "role=\"log\"" client/src/components/TranscriptView.tsx
    grep "aria-hidden" client/src/components/SkeletonBubble.tsx
    cd client && npx tsc --noEmit
  </verify>
  <done>
    TranscriptView.tsx has aria-live="polite", role="log", aria-label="Conversation transcript", aria-relevant="additions" on the transcript container.
    SkeletonBubble.tsx has aria-hidden="true" and role="presentation".
    TypeScript compiles clean.
  </done>
</task>

<task type="auto">
  <name>Task 2: Keyboard navigation + visible focus rings across all interactive elements</name>
  <files>
    client/src/components/ChatInput.tsx
    client/src/components/chat.css
  </files>
  <action>
    **Audit and update interactive elements for keyboard accessibility (UI-17):**

    All interactive elements must:
    1. Be natively focusable (button, textarea, input) — already true for existing elements
    2. Have visible focus rings via `:focus-visible` CSS
    3. Not trap keyboard focus

    **Modify `client/src/components/ChatInput.tsx`:**

    Add explicit `tabIndex={0}` is NOT needed for button and textarea (already focusable). However, add `aria-label` to the Send button if it doesn't have descriptive text visible to screen readers:
    ```tsx
    <button
      className="sendButton"
      onClick={handleSend}
      disabled={disabled || !value.trim()}
      aria-label="Send message"
      type="button"
    >
      Send
    </button>
    ```

    Add `aria-label` to the textarea:
    ```tsx
    <textarea
      ref={textareaRef}
      className="chatTextarea"
      value={value}
      onChange={handleChange}
      onKeyDown={handleKeyDown}
      placeholder="Type a message…"
      disabled={disabled}
      rows={1}
      maxLength={4000}
      aria-label="Message input"
      aria-multiline="true"
    />
    ```

    **Modify `client/src/components/chat.css`:**

    Update the existing `:focus-visible` rule (added in Plan 03-02) to be scoped to specific interactive elements and remove the `outline: none` that the textarea currently has (which blocks focus visibility):

    Replace the existing `.chatTextarea` focus rule:
    ```css
    .chatTextarea:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 2px var(--color-focus-ring);
    }

    .chatTextarea:focus-visible {
      outline: 2px solid var(--color-primary);
      outline-offset: 2px;
    }
    ```

    Add explicit focus-visible styles for send button and theme toggle (they should already inherit from the global `:focus-visible` rule added in 03-02 — verify they do and add overrides if needed):
    ```css
    .sendButton:focus-visible,
    .themeToggle:focus-visible {
      outline: 2px solid var(--color-primary);
      outline-offset: 2px;
      box-shadow: 0 0 0 4px var(--color-focus-ring);
    }
    ```

    For the Adaptive Card SDK's rendered buttons, add a CSS rule scoped to the card container to restore focus visibility (the SDK may apply its own styles that hide focus rings):
    ```css
    .adaptiveCardContainer button:focus-visible,
    .adaptiveCardContainer input:focus-visible,
    .adaptiveCardContainer select:focus-visible,
    .adaptiveCardContainer textarea:focus-visible {
      outline: 2px solid var(--color-primary) !important;
      outline-offset: 2px !important;
    }
    ```

    Also add a visually-hidden helper class for screen-reader-only text (may be useful for Phase 4 and future enhancements):
    ```css
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    ```

    Run `cd client && npx tsc --noEmit` — must exit 0.
    Run `npm test` — all tests pass.
  </action>
  <verify>
    grep "aria-label" client/src/components/ChatInput.tsx
    grep "focus-visible" client/src/components/chat.css
    grep "adaptiveCardContainer button:focus-visible" client/src/components/chat.css
    grep "sr-only" client/src/components/chat.css
    cd client && npx tsc --noEmit
    npm test
  </verify>
  <done>
    ChatInput.tsx has aria-label on both textarea and send button.
    chat.css has :focus-visible rules for textarea, sendButton, themeToggle, and adaptiveCardContainer interactive elements.
    .sr-only utility class exists in chat.css.
    TypeScript compiles clean. All tests pass.
  </done>
</task>

</tasks>

<verification>
- cd client && npx tsc --noEmit exits 0
- npm test exits 0 (full test suite passes including server allowlist tests from 03-01)
- grep "aria-live" client/src/components/TranscriptView.tsx returns a match
- grep "aria-hidden" client/src/components/SkeletonBubble.tsx returns a match
- grep "focus-visible" client/src/components/chat.css returns multiple matches
- grep "aria-label" client/src/components/ChatInput.tsx returns matches
</verification>

<success_criteria>
- UI-16: TranscriptView has aria-live="polite" role="log" — screen readers will announce new messages
- UI-17: All interactive elements (textarea, send button, theme toggle, card buttons) have visible :focus-visible rings; keyboard Tab navigation reaches every interactive element without traps
- SkeletonBubble is aria-hidden (decorative)
- Adaptive Card SDK-rendered buttons get :focus-visible overrides via CSS scoping
- .sr-only utility available for future a11y needs
</success_criteria>

<output>
After completion, create `.planning/phases/03-adaptive-cards-accessibility-theming/03-05-SUMMARY.md`
</output>
