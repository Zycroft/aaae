---
milestone: v1.5
audited: 2026-02-22T22:00:00Z
status: gaps_found
scores:
  requirements: 18/25
  phases: 2/3
  integration: 7/7
  flows: 3/3
gaps:
  requirements:
    - id: "ORCH-01"
      status: "partial"
      phase: "Phase 16"
      claimed_by_plans: ["16-03-PLAN.md"]
      completed_by_plans: ["16-03-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Phase 16 VERIFICATION.md does not exist. SUMMARY frontmatter claims complete. REQUIREMENTS.md checkbox unchecked."
    - id: "ORCH-02"
      status: "partial"
      phase: "Phase 16"
      claimed_by_plans: ["16-03-PLAN.md"]
      completed_by_plans: ["16-03-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Phase 16 VERIFICATION.md does not exist. SUMMARY frontmatter claims complete. REQUIREMENTS.md checkbox unchecked."
    - id: "ORCH-03"
      status: "partial"
      phase: "Phase 16"
      claimed_by_plans: ["16-03-PLAN.md"]
      completed_by_plans: ["16-03-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Phase 16 VERIFICATION.md does not exist. SUMMARY frontmatter claims complete. REQUIREMENTS.md checkbox unchecked."
    - id: "ORCH-04"
      status: "partial"
      phase: "Phase 16"
      claimed_by_plans: ["16-02-PLAN.md"]
      completed_by_plans: ["16-02-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Phase 16 VERIFICATION.md does not exist. SUMMARY frontmatter claims complete. REQUIREMENTS.md checkbox unchecked."
    - id: "ORCH-05"
      status: "partial"
      phase: "Phase 16"
      claimed_by_plans: ["16-01-PLAN.md"]
      completed_by_plans: ["16-01-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Phase 16 VERIFICATION.md does not exist. SUMMARY frontmatter claims complete. REQUIREMENTS.md checkbox unchecked."
    - id: "ORCH-06"
      status: "partial"
      phase: "Phase 16"
      claimed_by_plans: ["16-03-PLAN.md"]
      completed_by_plans: ["16-03-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Phase 16 VERIFICATION.md does not exist. SUMMARY frontmatter claims complete. REQUIREMENTS.md checkbox unchecked."
    - id: "ORCH-07"
      status: "partial"
      phase: "Phase 16"
      claimed_by_plans: ["16-01-PLAN.md"]
      completed_by_plans: ["16-01-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Phase 16 VERIFICATION.md does not exist. SUMMARY frontmatter claims complete. REQUIREMENTS.md checkbox unchecked."
  integration: []
  flows: []
tech_debt: []
---

# v1.5 Milestone Audit: Workflow Orchestrator + Structured Output Parsing

**Audited:** 2026-02-22
**Status:** gaps_found
**Reason:** Phase 16 missing VERIFICATION.md (unverified phase — blocker)

## Milestone Definition of Done

Transform the Node server from a stateless proxy into a Workflow Orchestrator that parses structured output from Copilot responses, maintains per-conversation workflow state in Redis, enriches outbound queries with accumulated context, and routes all existing endpoints through the orchestrator — while preserving passthrough behavior when Copilot returns unstructured text.

## Phase Verification Summary

| Phase | Name | VERIFICATION.md | Status | Requirements |
|-------|------|-----------------|--------|--------------|
| 15 | Parser + Context Builder | Present | **PASSED** | 8/8 satisfied |
| 16 | Workflow Orchestrator Engine | **MISSING** | **UNVERIFIED** | 7/7 partial (no verification) |
| 17 | Route Integration + Compatibility | Present | **PASSED** | 10/10 satisfied |

**Phases verified:** 2/3
**Blocker:** Phase 16 has no VERIFICATION.md — plans were executed and SUMMARYs created, but the verification step was never run.

## Requirements Coverage (3-Source Cross-Reference)

### Parsing Requirements (Phase 15) — 5/5 Satisfied

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS.md | Final |
|--------|-------------|--------------|---------|-----------------|-------|
| PARSE-01 | Multi-strategy extraction | passed | 15-02 | [x] Complete | **satisfied** |
| PARSE-02 | Zod validation with .passthrough() | passed | 15-02 | [x] Complete | **satisfied** |
| PARSE-03 | ParsedTurn with full field set | passed | 15-02 | [x] Complete | **satisfied** |
| PARSE-04 | Parser never throws | passed | 15-02 | [x] Complete | **satisfied** |
| PARSE-05 | Shared schemas in workflow.ts | passed | 15-01 | [x] Complete | **satisfied** |

### Context Building Requirements (Phase 15) — 3/3 Satisfied

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS.md | Final |
|--------|-------------|--------------|---------|-----------------|-------|
| CTX-01 | Preamble with step, data, turn count | passed | 15-03 | [x] Complete | **satisfied** |
| CTX-02 | Configurable preamble format | passed | 15-03 | [x] Complete | **satisfied** |
| CTX-03 | Max length truncation (2000 chars) | passed | 15-03 | [x] Complete | **satisfied** |

### Orchestration Requirements (Phase 16) — 0/7 Satisfied (7 Partial)

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS.md | Final |
|--------|-------------|--------------|---------|-----------------|-------|
| ORCH-01 | Start session with userId/tenantId | **missing** | 16-03 | [ ] Pending | **partial** |
| ORCH-02 | Full per-turn orchestration loop | **missing** | 16-03 | [ ] Pending | **partial** |
| ORCH-03 | Card action through orchestrator | **missing** | 16-03 | [ ] Pending | **partial** |
| ORCH-04 | WorkflowResponse with workflowState | **missing** | 16-02 | [ ] Pending | **partial** |
| ORCH-05 | Redis persistence survives restart | **missing** | 16-01 | [ ] Pending | **partial** |
| ORCH-06 | Context accumulation across turns | **missing** | 16-03 | [ ] Pending | **partial** |
| ORCH-07 | Per-conversation locking | **missing** | 16-01 | [ ] Pending | **partial** |

**Note:** All 7 ORCH requirements are claimed complete by SUMMARY frontmatter, and the integration checker verified the code wiring is correct. The gap is process-level: no formal VERIFICATION.md was produced for Phase 16, and REQUIREMENTS.md checkboxes were never updated.

### Route Requirements (Phase 17) — 4/4 Satisfied

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS.md | Final |
|--------|-------------|--------------|---------|-----------------|-------|
| ROUTE-01 | /start delegates to orchestrator | passed | 17-02 | [x] Complete | **satisfied** |
| ROUTE-02 | /send delegates to orchestrator | passed | 17-02 | [x] Complete | **satisfied** |
| ROUTE-03 | /card-action delegates to orchestrator | passed | 17-02 | [x] Complete | **satisfied** |
| ROUTE-04 | Response schemas include workflowState | passed | 17-01 | [x] Complete | **satisfied** |

### Compatibility Requirements (Phase 17) — 3/3 Satisfied

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS.md | Final |
|--------|-------------|--------------|---------|-----------------|-------|
| COMPAT-01 | Passthrough mode identical to v1.4 | passed | 17-02 | [x] Complete | **satisfied** |
| COMPAT-02 | Allowlist before orchestrator | passed | 17-02 | [x] Complete | **satisfied** |
| COMPAT-03 | No regression in existing functionality | passed | 17-02 | [x] Complete | **satisfied** |

### Testing Requirements (Phase 17) — 3/3 Satisfied

| REQ-ID | Description | VERIFICATION | SUMMARY | REQUIREMENTS.md | Final |
|--------|-------------|--------------|---------|-----------------|-------|
| TEST-01 | Parser unit tests (15 tests) | passed | 17-03 | [x] Complete | **satisfied** |
| TEST-02 | Context builder unit tests (10 tests) | passed | 17-03 | [x] Complete | **satisfied** |
| TEST-03 | Multi-turn integration test (3+ turns) | passed | 17-03 | [x] Complete | **satisfied** |

### Summary

| Category | Satisfied | Partial | Unsatisfied | Total |
|----------|-----------|---------|-------------|-------|
| Parsing | 5 | 0 | 0 | 5 |
| Context | 3 | 0 | 0 | 3 |
| Orchestration | 0 | 7 | 0 | 7 |
| Routes | 4 | 0 | 0 | 4 |
| Compatibility | 3 | 0 | 0 | 3 |
| Testing | 3 | 0 | 0 | 3 |
| **Total** | **18** | **7** | **0** | **25** |

## Cross-Phase Integration (7/7 Connections Verified)

The integration checker confirmed all cross-phase wiring is correct:

| Connection | From | To | Status |
|------------|------|----|--------|
| Shared schemas | Phase 15.01 workflow.ts | Phase 15.02, 16.03, 17.01 | WIRED |
| parseTurn() | Phase 15.02 | Phase 16.03 orchestrator | WIRED |
| buildContextualQuery() | Phase 15.03 | Phase 16.03 orchestrator | WIRED |
| Store + Lock (DI) | Phase 16.01 | Phase 16.03 orchestrator | WIRED |
| WorkflowDefinition | Phase 16.02 | Phase 16.03 orchestrator | WIRED |
| Orchestrator singleton | Phase 16.03 | Phase 17.02 routes | WIRED |
| API schemas | Phase 17.01 | Phase 17.02 routes | WIRED |

**No orphaned exports. No missing connections. No broken wiring.**

## E2E Flow Verification (3/3 Flows Complete)

### Flow 1: Start Conversation
```
POST /api/chat/start → auth middleware → orchestrator.startSession()
  → creates WorkflowState in Redis → returns { conversationId, workflowState }
```
**Status:** Complete

### Flow 2: Send Message (Multi-Turn with Context Accumulation)
```
POST /api/chat/send → auth middleware → orchestrator.processTurn()
  → lock acquire → load state → buildContextualQuery() [injects prior data]
  → Copilot call → normalizeActivities() → parseTurn()
  → merge collectedData → save state → unlock → return response
```
**Status:** Complete — TEST-03 verifies 3-turn accumulation

### Flow 3: Card Action
```
POST /api/chat/card-action → auth middleware → validateCardAction() [allowlist]
  → orchestrator.processCardAction() → lock → load → Copilot → parse
  → merge → save → unlock → return response
```
**Status:** Complete — allowlist returns 403 before orchestrator on violations

## Tech Debt

No tech debt items flagged by Phase 15 or Phase 17 verifications. Phase 16 was not verified so no tech debt was formally catalogued from it.

## Test Results

- **Total tests:** 147/147 passing
- **Parser tests (Phase 15):** 15/15
- **Context builder tests (Phase 15):** 10/10
- **Store tests (Phase 16):** 7/7
- **Lock tests (Phase 16):** 9/9
- **Orchestrator unit tests (Phase 16):** 10/10
- **Integration tests (Phase 17):** 5/5
- **Pre-existing tests:** All passing, zero regressions

## Gap Resolution Path

The single gap is **process-level**, not functional:

1. **Phase 16 VERIFICATION.md missing** — Run the gsd-verifier against Phase 16 to produce the missing verification document. All code and tests are in place; the verification step was skipped during execution.

2. **REQUIREMENTS.md checkboxes** — Update ORCH-01 through ORCH-07 from `[ ]` to `[x]` and status from "Pending" to "Complete" once verification confirms.

**Expected outcome:** Once Phase 16 verification runs and passes (highly likely given integration checker confirmed all wiring), all 25 requirements become satisfied and milestone status upgrades to **passed**.

---
*Audited: 2026-02-22*
*Auditor: Claude Code (gsd audit-milestone)*
