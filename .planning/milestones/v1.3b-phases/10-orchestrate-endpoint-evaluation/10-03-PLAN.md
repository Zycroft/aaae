---
phase: 10-orchestrate-endpoint-evaluation
plan: 03
type: execute
wave: 3
depends_on: [10-02]
files_modified:
  - spike/SDK-EVALUATION.md
autonomous: false
requirements: [EVAL-01, EVAL-02, EVAL-03]

must_haves:
  truths:
    - "spike/SDK-EVALUATION.md exists with all evaluation criteria sections filled"
    - "The document contains a clear GO, CONDITIONAL GO, or NO GO recommendation with written rationale"
    - "Latency measurements reference real numbers from spike/LATENCY-RESULTS.md"
    - "Structured output reliability findings reference Phase 8 normalizer test results"
    - "Context injection coherence findings reference Phase 9 spike results"
    - "Agent-side configuration requirements section documents what Copilot Studio must return for structured output"
    - "The evaluation is readable by a product manager — clear language, not just technical jargon"
  artifacts:
    - path: "spike/SDK-EVALUATION.md"
      provides: "SDK evaluation document with GO/CONDITIONAL GO recommendation"
      contains: "Recommendation"
      min_lines: 60
  key_links:
    - from: "spike/SDK-EVALUATION.md"
      to: "spike/LATENCY-RESULTS.md"
      via: "references latency measurements"
      pattern: "LATENCY-RESULTS"
    - from: "spike/SDK-EVALUATION.md"
      to: "spike/CONTEXT-INJECTION-RESULTS.md"
      via: "references context injection findings"
      pattern: "CONTEXT-INJECTION"
---

<objective>
Create spike/SDK-EVALUATION.md — a comprehensive evaluation document that consolidates all SDK findings from Phases 8–10 and delivers a GO/CONDITIONAL GO recommendation for the v1.5 Workflow Orchestrator.

Purpose: This document is the deliverable that decides whether the project proceeds to v1.5. It must be evidence-based, citing real measurements and test results from prior phases. It also documents agent-side configuration requirements (EVAL-03).

Output: spike/SDK-EVALUATION.md with all criteria filled, recommendation stated, and agent requirements documented.
</objective>

<execution_context>
@/Users/zycroft/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zycroft/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/10-orchestrate-endpoint-evaluation/10-02-SUMMARY.md
@spike/LATENCY-RESULTS.md
@spike/CONTEXT-INJECTION-RESULTS.md
@server/src/normalizer/activityNormalizer.ts
@server/src/routes/orchestrate.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SDK-EVALUATION.md with criteria and findings</name>
  <files>spike/SDK-EVALUATION.md</files>
  <action>
    Create spike/SDK-EVALUATION.md with the following structure. Populate findings by reading actual results from spike files and test outputs.

    ```markdown
    # Copilot Studio SDK Evaluation for v1.5 Workflow Orchestrator

    **Date:** {today}
    **Evaluator:** Automated (Claude Code)
    **Milestone:** v1.3b — Copilot Studio SDK: Orchestrator Readiness
    **Recommendation:** [GO / CONDITIONAL GO / NO GO]

    ## Executive Summary

    [2-3 sentences summarizing the evaluation outcome. Readable by a product manager.]

    ## Evaluation Criteria

    ### 1. Latency Performance

    **Threshold:** Round-trip latency < 5000ms for standard messages
    **Source:** spike/LATENCY-RESULTS.md

    | Metric | Median | Threshold | Result |
    |--------|--------|-----------|--------|
    | startConversation | [from LATENCY-RESULTS or TBD] | < 10s | [PASS/FAIL/TBD] |
    | sendMessage | [from LATENCY-RESULTS or TBD] | < 5s | [PASS/FAIL/TBD] |
    | Full round-trip | [from LATENCY-RESULTS or TBD] | < 5s | [PASS/FAIL/TBD] |

    **Assessment:** [1-2 sentences]

    ### 2. Structured Output Extraction

    **Threshold:** Normalizer can extract structured JSON from at least 2 of 3 surfaces
    **Source:** Phase 8 normalizer tests (34 tests)

    | Surface | Extraction Works | Confidence Level | Result |
    |---------|-----------------|------------------|--------|
    | activity.value | Yes | high | PASS |
    | activity.entities | Yes | medium | PASS |
    | bot text (JSON embedded) | Yes | low | PASS |

    **Assessment:** All three extraction surfaces implemented and tested. ExtractedPayload schema validates with confidence levels.

    ### 3. Context Injection Coherence

    **Threshold:** Agent responds coherently to 3-turn conversation with injected context
    **Source:** spike/CONTEXT-INJECTION-RESULTS.md

    | Scenario | Turns Passed | Context Size | Result |
    |----------|-------------|-------------|--------|
    | Small context | [from results or TBD] | ~500 chars | [PASS/FAIL/TBD] |
    | Large context | [from results or TBD] | ~1000 chars | [PASS/FAIL/TBD] |

    **Assessment:** [1-2 sentences about context injection findings]

    ### 4. Conversation Continuity

    **Threshold:** Agent demonstrates awareness of prior turns in 3-turn sequence
    **Source:** spike/CONTEXT-INJECTION-RESULTS.md (ORCH-04 section)

    **Assessment:** [1-2 sentences about whether state was preserved across turns]

    ### 5. Orchestrate Endpoint

    **Threshold:** Single endpoint consolidates start + send + normalize + extract + measure
    **Source:** server/src/routes/orchestrate.ts

    | Capability | Implemented | Result |
    |-----------|-------------|--------|
    | Accepts query + workflowContext | Yes | PASS |
    | Returns messages | Yes | PASS |
    | Returns extractedPayload | Yes | PASS |
    | Returns latencyMs | Yes | PASS |
    | Returns workflowState | Yes | PASS |
    | No modifications to existing routes | Yes | PASS |

    **Assessment:** Endpoint provides batteries-included interface for orchestrator.

    ## Agent-Side Configuration Requirements (EVAL-03)

    What the Copilot Studio agent must be configured to return for structured output extraction to work reliably:

    1. **activity.value usage:** The agent's topic should use "Send a message" actions with the Message type set to include structured data in the activity value field. This is the highest-confidence extraction surface.

    2. **JSON in bot text:** If the agent embeds JSON in text responses, it should use standard JSON formatting (valid JSON.parse-able strings). The normalizer uses regex + JSON.parse fallback.

    3. **Entity annotations:** The SDK may attach entity metadata to activities. The normalizer extracts non-type fields from entities. Agent authors should be aware this surface exists but has medium confidence.

    4. **Context prefix parsing:** The agent should be designed to recognize the [WORKFLOW_CONTEXT]...[/WORKFLOW_CONTEXT] prefix format. This is not a strict requirement — the prefix is human-readable — but agents that parse it explicitly will provide better structured responses.

    5. **Multi-turn state:** The agent should not rely on its own conversation memory for workflow state. The orchestrator manages state externally and re-injects it via workflowContext on each turn.

    ## Risk Assessment

    | Risk | Severity | Mitigation |
    |------|----------|------------|
    | Latency variability | Medium | Orchestrator should implement timeout + retry |
    | Text extraction reliability | Low | Priority chain (value > entities > text) provides fallback |
    | Context prefix not parsed | Low | Prefix is human-readable; works even if agent doesn't explicitly parse |
    | Agent configuration dependency | Medium | Document requirements clearly; provide agent setup guide |

    ## Recommendation

    **[GO / CONDITIONAL GO]**

    **Rationale:** [3-5 sentences explaining why the SDK is ready (or conditionally ready) for the v1.5 Workflow Orchestrator, citing specific evidence from the evaluation criteria above]

    **Conditions (if CONDITIONAL GO):**
    - [Condition 1 that must be met before v1.5 proceeds]
    - [Condition 2]

    ## Appendix: Test Evidence

    - **Normalizer tests:** 34 tests passing (server/src/normalizer/activityNormalizer.test.ts)
    - **Schema tests:** 9 WorkflowContext tests + WorkflowState tests (shared/)
    - **Latency baseline:** spike/LATENCY-RESULTS.md
    - **Context injection:** spike/CONTEXT-INJECTION-RESULTS.md
    - **Orchestrate endpoint:** server/src/routes/orchestrate.ts

    ---
    *Evaluation completed: {today}*
    *Milestone: v1.3b — Copilot Studio SDK: Orchestrator Readiness*
    ```

    **IMPORTANT:** Read spike/LATENCY-RESULTS.md and spike/CONTEXT-INJECTION-RESULTS.md at execution time. If they contain [TBD] placeholders (credentials weren't available), use those placeholders in the evaluation and note that real measurements are pending. Still produce a CONDITIONAL GO recommendation noting the pending measurements as a condition.

    Run `npm test` to verify current test count for the appendix.
  </action>
  <verify>
    File exists at spike/SDK-EVALUATION.md.
    All required sections present: Executive Summary, 5 Evaluation Criteria, Agent-Side Configuration Requirements, Risk Assessment, Recommendation, Appendix.
    grep for "Recommendation" in the file returns at least one match.
  </verify>
  <done>
    spike/SDK-EVALUATION.md exists with all evaluation criteria filled, a clear recommendation stated, and agent-side configuration requirements documented.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Checkpoint: Review SDK evaluation and sign off on recommendation</name>
  <files>spike/SDK-EVALUATION.md</files>
  <action>Human reviews the SDK evaluation document and confirms the recommendation is appropriate.</action>
  <what-built>
    SDK-EVALUATION.md consolidating all Phase 8-10 findings into a GO/CONDITIONAL GO recommendation.
    The document covers latency, structured output, context injection, conversation continuity, and orchestrate endpoint readiness.
  </what-built>
  <how-to-verify>
    1. Read spike/SDK-EVALUATION.md
    2. Verify all criteria sections have findings (real numbers or [TBD] with explanation)
    3. Verify agent-side configuration requirements are documented (EVAL-03)
    4. Verify recommendation is stated with rationale
    5. If real Copilot credentials are available:
       - Run: `npx tsx spike/latency-baseline.ts` to populate LATENCY-RESULTS.md
       - Run: `npx tsx spike/context-injection-spike.ts` to populate CONTEXT-INJECTION-RESULTS.md
       - Update SDK-EVALUATION.md with real numbers
    6. Confirm the recommendation reflects the evidence
  </how-to-verify>
  <resume-signal>Type "approved" once you have reviewed the evaluation document and are satisfied with the recommendation. If you ran the spike scripts with real credentials, describe the results.</resume-signal>
</task>

</tasks>

<verification>
- spike/SDK-EVALUATION.md exists with all required sections
- EVAL-01: All criteria filled (with real measurements or TBD placeholders)
- EVAL-02: GO or CONDITIONAL GO recommendation with written rationale
- EVAL-03: Agent-side configuration requirements section present
- Human checkpoint completed
</verification>

<success_criteria>
spike/SDK-EVALUATION.md delivers a clear, evidence-based GO or CONDITIONAL GO recommendation for the v1.5 Workflow Orchestrator. All evaluation criteria are filled from real Phase 8-10 measurements. Agent-side configuration requirements are documented for Copilot Studio authors.
</success_criteria>

<output>
After completion, create `.planning/phases/10-orchestrate-endpoint-evaluation/10-03-SUMMARY.md`
</output>
